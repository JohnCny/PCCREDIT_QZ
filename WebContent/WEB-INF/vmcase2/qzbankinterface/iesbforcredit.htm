#parse ("common/iframe_page_header.htm")
#parse ("common/macro.htm")
<body>
  <div class="content_main">
    <div class="contentinner">
      <div class="place">
        <div class="title">传统</div>
      </div>
      <form id="id_module_form">
        <div class="forms" id="formsId">
          <table class="rule" bordercolor="#CCCCCC" border="1">
          <caption>客户贷款信息</caption>
            <colgroup>
              <col width="10%" />
              <col width="40%" />
              <col width="10%" />
              <col width="40%" />
            </colgroup>
            <tr>
              <td><label>客户号:</label></td>
              <td><select id="selectClientNo" onchange="changeClientNo(this)">
              			<option value="0" >请选择</option>
		              	#foreach($!obj in $!ECIF_ls)
									<option value="$!obj.clientNo" >
										$!obj.clientName
									</option>
								#end	
		              </select><input type="hidden" id="clientNo" name="clientNo"/></td></td>
              <td><label>币种:</label></td>
              <td><select name="ccy">#dict("CONT_CUR_TYPE", "")</select></td>
            </tr>
            <tr>
              <td><label>授信额度:</label></td>
              <td><input type="text" name="creditLimit" value="" /></td>
              <td><label>担保方式:</label></td>
              <td><select name="guaranteeMode">#dict("ASSURE_MAIN", "")</select></td>
            </tr>
            <tr>
              <td><label>期限类型:</label></td>
              <td><select name="termType">#dict("TERM_TYPE", "")</select></td>
			  <td><label>期限:</label></td>
              <td><input type="text" name="term" value=""/></td>
            </tr>
			<tr>
              <td><label>贷款起始日期:</label></td>
              <td><input type="text" name="startDate" onmouseover="_calendar()"/></td>
			  <td><label>贷款结束日期:</label></td>
              <td><input type="text" name="endDate" onmouseover="_calendar()"/></td>
            </tr>
		</table>
		<table class="rule" bordercolor="#CCCCCC" border="1">
          <caption>客户信息</caption>
            <colgroup>
              <col width="10%" />
              <col width="40%" />
              <col width="10%" />
              <col width="40%" />
            </colgroup>
			<tr>
              <td><label>客户号:</label></td>
              <td><input type="text" id="aClientNo" name="aClientNo"/></td>
			  <td><label>客户名称:</label></td>
              <td><input type="text" id="clientName" name="clientName"/></td>
            </tr>
			<tr>
              <td><label>性别:</label></td>
              <td><select id="sex" name="sex">#dict("INDIV_SEX", "")</select></td>
			  <td><label>客户类型:</label></td>
              <td><select id="clientType" name="clientType">#dict("CLIENT_TYPE", "")</select></td>
            </tr>
			<tr>
              <td><label>证件类型:</label></td>
              <td><select id="globalType" name="globalType">#dict("CERT_TYPE", "")</select></td>
			  <td><label>证件号码:</label></td>
              <td><input type="text" id="globalId" name="globalId"/></td>
            </tr>
			<tr>
              <td><label>长期证件标志:</label></td>
              <td><select id="longGlobalType" name="longGlobalType">#dict("IS_LONG_INDIV", "")</select></td>
			  <td><label>签发日期:</label></td>
              <td><input type="text" id="issDate" name="issDate" onmouseover="_calendar()"/></td>
            </tr>
			<tr>
              <td><label>证件有效日期:</label></td>
              <td><input type="text" id="globalEffDate" name="globalEffDate" onmouseover="_calendar()"/></td>
			  <td><label>农户标识:</label></td>
              <td><select id="agriFlag" name="agriFlag">#dict("AGRI_FLG", "")</select></td>
            </tr>
			<tr>
              <td><label>国家代码:</label></td>
              <td><select id="countryCode" name="countryCode">#dict("CUS_COUNTRY", "")</select></td>
			  <td><label>民族代码:</label></td>
              <td><select id="nationalityCode" name="nationalityCode">#dict("NATIONALITY_CODE", "")</select></td>
            </tr>
			<tr>
              <td><label>户籍所在地:</label></td>
              <td>
              	1:<select id="regPermResidence_1" name="regPermResidence_1" style="width:29%;margin:2px;" onchange="change_regPermResidence_1(this.value);">#dict("INDIV_BRT_PLACE_LEVEL_1", "")</select>
            	2:<select id="regPermResidence_2" name="regPermResidence_2" style="width:29%;margin:2px;" onchange="change_regPermResidence_2(this.value);">#dict("INDIV_BRT_PLACE_LEVEL_2", "")</select>
            	3:<select id="regPermResidence_3" name="regPermResidence_3" style="width:29%;margin:2px;">#dict("INDIV_BRT_PLACE_LEVEL_3", "")</select>
              </td>
			  <td><label>地址:</label></td>
              <td><input type="text" id="address" name="address"/></td>
            </tr>
			<tr>
              <td><label>出生日期:</label></td>
              <td><input type="text" id="birthDate" name="birthDate" onmouseover="_calendar()"/></td>
			  <td><label>最高学历:</label></td>
              <td><select id="education" name="education">#dict("INDIV_EDT", "")</select></td>
            </tr>
			<tr>
              <td><label>最高学位:</label></td>
              <td><select id="degree" name="degree">#dict("INDIV_DGR", "")</select></td>
			  <td><label>签约日期:</label></td>
              <td><input type="text" id="signDate" name="signDate" onmouseover="_calendar()"/></td>
            </tr>
			<tr>
              <td><label>持卡情况:</label></td>
              <td><select id="holdCardMsg" name="holdCardMsg">#dict("HOLD_CARD", "")</select></td>
			  <td><label>是否拥有外国护照或居住权:</label></td>
              <td><select id="passportFlag" name="passportFlag">#dict("PASSPORT_FLG", "")</select></td>
            </tr>
			<tr>
              <td><label>信用等级:</label></td>
              <td><select id="creditLevel" name="creditLevel">#dict("CUS_CRD_GRADE", "")</select></td>
			  <td><label>信用到期日期:</label></td>
              <td><input type="text" id="expiryDate" name="expiryDate" onmouseover="_calendar()"/></td>
            </tr>
			<tr>
              <td><label>是否关联客户:</label></td>
              <td><select id="relClientFlag" name="relClientFlag">#dict("IS_RELA_CUST", "")</select></td>
			  <td><label>与我行关系:</label></td>
              <td><select id="ownBranchRelation" name="ownBranchRelation">#dict("CUS_BANK_REL", "")</select></td>
            </tr>
			<tr>
              <td><label>我行职务:</label></td>
              <td><select id="post" name="post">#dict("BANK_DUTY", "")</select></td>
			  <td><label>贷款卡标识:</label></td>
              <td><select id="loanCardFlag" name="loanCardFlag">#dict("LOAN_CARD_FLG", "")</select></td>
            </tr>
			<tr>
              <td><label>贷款卡号:</label></td>
              <td><input type="text" id="loanCardNo" name="loanCardNo"/></td>
			  <td><label>手机号码:</label></td>
              <td><input type="text" id="mobile" name="mobile"/></td>
            </tr>
			<tr>
              <td><label>上级机构:</label></td>
              <td><input type="text" id="higherOrgNo" name="higherOrgNo" value="$!parentOrgId"></td>
			  <td><label>客户经理:</label></td>
              <td><input type="text" id="acctExec" name="acctExec"/></td>
            </tr>
			<tr>
			  <td><label>业务类型:</label></td>
              <td><select name="bussType">#dict("BUSS_TYPE", "")</select></td>
              <td><label>开户日期:</label></td>
              <td><input type="text" id="openAcctDate" name="openAcctDate" onmouseover="_calendar()"/></td>
            </tr>
		  </table>
        </div>
      <div class="submit">
        <input id="id_save_button" type="button" value="#i18n("button.save")" class="current" />
      </div>
      </form>
    </div>
  </div>
  <script type="text/javascript">
	//新开户json信息
	var ecifJsonObj;
	//级联
	//户籍所在地
	var indiv_brt_place_array2 = new Array();//用来保存为显示的select元素
	var indiv_brt_place_array3 = new Array();//用来保存为显示的select元素
	
	var layout=new FormsLayout("formsId");	
	window.top.currentWindow.setLayout(layout);
	#set ($formName = "'#id_module_form'")
	
	#parse ("qzbankinterface/iesbforcredit_validation.js")
	
	$(document).ready(function() {	
		
		ecifJsonObj = $!ECIF_ls_json;
		
		#parse("common/part_create.js")
		
		$("#id_save_button").click(function() {
			if($("#selectClientNo").val() == 0){
				alert("请先选择对应客户!")
			}else{
				if ($($formName).valid()) {
					var formjson = $($formName).serialize();
		   	          $.post("${modulePath}/insert.json", formjson, function(data, textStatus, jqXhr) {
		   	            if (data.success) {
		   	            	Dialog.message("保存成功!");
		   	            	window.location.href= contextPath+"/intopieces/credit/create.page" ;
		   	            }
		   	          });
				}
			}
		})
		
		//级联菜单
		//户籍所在地
		$("#regPermResidence_2 option").each(function(){ //遍历全部option
			indiv_brt_place_array2.push($(this));
	    });
		$("#regPermResidence_3 option").each(function(){ //遍历全部option
			indiv_brt_place_array3.push($(this));
	    });
	});
	
	//级联
	//户籍所在地
	function change_regPermResidence_1(objval){
		$("#regPermResidence_2").empty();
		$("#regPermResidence_2").css('visibility','hidden');//IE7
		$.each(indiv_brt_place_array2,function(n,opt) { 
			if(opt.val().split("_")[0] == objval.split("_")[1]){
				$("#regPermResidence_2").append(opt);
			}
		});
		$("#regPermResidence_2").css('visibility','visible');//IE7
		
		var tmp = $("#regPermResidence_2 option:first");//IE7
		change_regPermResidence_2(tmp.val());
	}
	function change_regPermResidence_2(objval){
		$("#regPermResidence_3").empty();
		$("#regPermResidence_3").css('visibility','hidden');//IE7
		$.each(indiv_brt_place_array3,function(n,opt) {  
			if(opt.val().split("_")[0] == objval.split("_")[1]){
				$("#regPermResidence_3").append(opt);
			}
		});
		$("#regPermResidence_3").css('visibility','visible');//IE7
	}
	
	//信息自动填充
	function changeClientNo(obj){
		//客户信息自动填充
		$("#clientNo").val(ecifJsonObj[obj.selectedIndex-1].clientNo);
		$("#aClientNo").val(ecifJsonObj[obj.selectedIndex-1].clientNo);
		$("#clientName").val(ecifJsonObj[obj.selectedIndex-1].clientName);
		$("#sex").val(ecifJsonObj[obj.selectedIndex-1].sex);
		$("#clientType").val(ecifJsonObj[obj.selectedIndex-1].clientType);
		$("#globalType").val(ecifJsonObj[obj.selectedIndex-1].globalType);
		$("#globalId").val(ecifJsonObj[obj.selectedIndex-1].globalId);
		//$("#longGlobalType").val();
		$("#issDate").val(ecifJsonObj[obj.selectedIndex-1].issDate);
		$("#globalEffDate").val(ecifJsonObj[obj.selectedIndex-1].expiryDate);//证件有效日期expiryDate
		//$("#agriFlag").val();
		$("#countryCode").val(ecifJsonObj[obj.selectedIndex-1].countryCitizen);//国籍countryCitizen
		$("#nationalityCode").val(ecifJsonObj[obj.selectedIndex-1].nationalityCode);
		$("#regPermResidence_1").val(ecifJsonObj[obj.selectedIndex-1].regPermResidence_1);
		$("#regPermResidence_2").val(ecifJsonObj[obj.selectedIndex-1].regPermResidence_2);
		$("#regPermResidence_3").val(ecifJsonObj[obj.selectedIndex-1].regPermResidence_3);
		$("#address").val(ecifJsonObj[obj.selectedIndex-1].address);
		$("#birthDate").val(ecifJsonObj[obj.selectedIndex-1].birthDate);
		$("#education").val(ecifJsonObj[obj.selectedIndex-1].educationLevel);//教育水平educationLevel
		//$("#degree").val();
		//$("#signDate").val();
		//$("#holdCardMsg").val();
		//$("#passportFlag").val();
		//$("#creditLevel").val();
		//$("#expiryDate").val();
		//$("#relClientFlag").val();
		$("#ownBranchRelation").val(ecifJsonObj[obj.selectedIndex-1].incidenceRelation);//关联关系incidenceRelation
		//$("#post").val();
		//$("#loanCardFlag").val();
		//$("#loanCardNo").val();
		$("#mobile").val(ecifJsonObj[obj.selectedIndex-1].contactMode);//联系方式？
		//$("#higherOrgNo").val();
		$("#acctExec").val(ecifJsonObj[obj.selectedIndex-1].custManagerId);//客户经理
		$("#openAcctDate").val(ecifJsonObj[obj.selectedIndex-1].openAcctDate);
		
	}
	</script>
</body>
#parse ("common/iframe_page_footer.htm")
